MenuController=function(n,t,i,r){"use strict";function e(){f();n.$on("loggedIn",function(){n.loginStatus=i.getLoginStatus();var t=r.employeeGetById();n.role=t.RoleName.toLowerCase();n.loggedInUsername=t.FirstName+" "+t.LastName;n.navigate("EmployeeCalendar");$(".menu-toggle").click(function(){$(".mainContainer").toggleClass("minimized");$(".menu-toggle").hasClass("fa-caret-square-o-left")?($(".menu-toggle").removeClass("fa-caret-square-o-left"),$(".menu-toggle").addClass("fa-caret-square-o-right")):($(".menu-toggle").removeClass("fa-caret-square-o-right"),$(".menu-toggle").addClass("fa-caret-square-o-left"))})})}function f(){t.menuGotoView(n,views.Menu,".side-bar-menu");t.gotoView(n,views.Login);n.loginStatus=i.getLoginStatus()}var u;n.logOut=function(){i.setToken("",!1);f()};n.navigate=function(i){if(typeof n.state=="undefined"&&(n.state="New"),n.state==="New"?(n.state="Old",u=n.$new(),t.gotoView(u,views[i])):(u.$destroy(),$(".bodyContainer").empty(),n.state="New",n.navigate(i)),i!=="Link"){var f=$(".menuLink"),e=$("#"+i);f.css("pointer-events","all");e.css("pointer-events","none");f.removeClass("active");e.addClass("active")}i==="EmployeeCalendar"&&r.refreshUser()};e()};MenuController.$inject=["$scope","viewService","tokenService","userService"];LoginController=function(n,t,i){"use strict";var r=this;n.login=function(){t.getLoginAuthToken(n.username,n.password).then(function(){i.setUser()},function(){$(".alert").show();$("#password").val("")})}};LoginController.$inject=["$scope","dataService","userService"];CalendarController=function(n,t,i,r){"use strict";function u(n){for(var t=[],i=!0,u=null;n.length!==1;)n[0].StartDate.day()+1===n[1].StartDate.day()&&i===!0&&n[0].BookingStatus===n[1].BookingStatus?(n[0].EndDate=n[1].StartDate,n[0].AllowanceDays++,n.length===2&&t.push(n[0]),n.splice(1,1),i=!1):n[0].EndDate.day()+1===n[1].StartDate.day()&&i===!1&&n[0].BookingStatus===n[1].BookingStatus?(n[0].EndDate=n[1].StartDate,n[0].AllowanceDays++,n.length===2&&t.push(n[0]),n.splice(1,1)):n[0].EndDate.day()+1===n[1].StartDate.day()&&n[0].BookingStatus!==n[1].BookingStatus?(n[1].HolidayId=r.guid(),t.push(n[0]),n.length===2&&t.push(n[1]),n.splice(0,1),i=!0):(u===n[0].HolidayId?n[0].HolidayId=r.guid():u=n[0].HolidayId,t.push(n[0]),n.length===2&&t.push(n[1]),n.splice(0,1),i=!0);return t}n.init=function(r){n.mode=r;n.editMode=!1;n.changes=[];t.publicHolidaysGet().then(function(u){u.data.forEach(function(n){n.Date=moment(n.Date,"YYYY-MM-DD-Z")});n.publicHolidays=u.data;n.selected=moment();r==="manager"?t.employeesGet().then(function(t){n.teamUserHolidayBookings=t.data;n.initData(n.teamUserHolidayBookings);n.getListOfTeamMembers(n.teamUserHolidayBookings);i.calendarGoToView(n,views.CalendarModeManager);n.tabPendingHolidays=[]}):t.employeesGet().then(function(t){n.teamUserHolidayBookings=t.data;n.initData(n.teamUserHolidayBookings);n.getListOfTeamMembers(n.teamUserHolidayBookings);i.calendarGoToView(n,views.CalendarModeEmployee)})})};n.initData=function(t){for(var i=0;i<t.length;i++)n.parseDateTimeToMoment(t[i].HolidayBookings);for(n.unmergeHolidayBookings(t),i=0;i<t.length;i++)t[i].HolidayBookings=_.sortBy(t[i].HolidayBookings,function(n){return n.StartDate})};n.unmergeHolidayBookings=function(n){for(var u,i,r,t=0;t<n.length;t++){for(u=n[t].HolidayBookings.length,i=0;i<u;i++)while(n[t].HolidayBookings[i].StartDate.day()!==n[t].HolidayBookings[i].EndDate.day())r=_.cloneDeep(n[t].HolidayBookings[i]),r.EndDate=moment(r.EndDate),r.StartDate=r.EndDate,n[t].HolidayBookings.push(r),n[t].HolidayBookings[i].EndDate=n[t].HolidayBookings[i].EndDate.subtract(1,"days");n[t].RemainingAllowance=n[t].HolidayAllowance-n[t].HolidayBookings.length}};n.setAllowanceDaysOfUnmergedHolidays=function(n){for(var t=0;t<n.HolidayBookings.length;t++)n.HolidayBookings[t].AllowanceDays=1};n.parseDateTimeToMoment=function(n){for(var t,i=0;i<n.length;i++)t=n[i],typeof t.StartDate=="object"?(t.StartDate=moment(t.StartDate,"YYYY-MM-DD-Z"),t.EndDate=moment(t.EndDate,"YYYY-MM-DD Z")):(t.StartDate=moment(t.StartDate+"-+0000","YYYY-MM-DD-Z"),t.EndDate=moment(t.EndDate+"-+0000","YYYY-MM-DD Z"))};n.getListOfTeamMembers=function(t){for(var r=[],i=0;i<t.length;i++)r.push({Name:t[i].FirstName+" "+t[i].LastName,StaffId:t[i].StaffId});n.listOfTeamMembers=r};n.toggleEditMode=function(t){n.editMode=!n.editMode;$(t.target).toggleClass("active")};n.submitHolidaySingleEmployee=function(){var i,r,f;n.userHolidayBookings.HolidayBookings=_.sortBy(n.userHolidayBookings.HolidayBookings,function(n){return n.StartDate});n.setAllowanceDaysOfUnmergedHolidays(n.userHolidayBookings);i=_.cloneDeep(n.userHolidayBookings);r=i.HolidayBookings;n.parseDateTimeToMoment(r);r.length>0&&(f=u(r),f.length>0&&(i.HolidayBookings=f));i.isVisible=!1;n.hideChanges($(".changesContainer"),function(){n.changes=[]});t.employeeUpdateHoliday(i)};n.submitTeamUsersData=function(){for(var f,e,o,s=[],r=n.teamUserHolidayBookings,i=0;i<r.length;i++)r[i].HolidayBookings=_.sortBy(r[i].HolidayBookings,function(n){return n.StartDate}),n.setAllowanceDaysOfUnmergedHolidays(r[i]),f=_.cloneDeep(r[i]),e=f.HolidayBookings,n.parseDateTimeToMoment(e),e.length>0&&(o=u(e),o.length>0&&(f.HolidayBookings=o)),s.push(f);t.employeesUpdateHolidays(s).then(function(){n.hideChanges($(".actionsContainer"))})}};CalendarController.$inject=["$scope","dataService","viewService","helperService"];ManagementController=function(n,t,i){"use strict";n.init=function(){i.userGet().then(function(t){n.data=t.data.ListOfCalendarViewModels;n.roles=t.data.ListOfIdentityRoles})};n.delete=function(t){i.userDelete(t).then(function(){i.userGet().then(function(t){n.data=t.data.ListOfCalendarViewModels})})};n.register=function(t){i.userRegister(t).then(function(){$(".createContainer").toggleClass("hidden");$(".createUserForm").trigger("reset");i.userGet().then(function(t){n.data=t.data.ListOfCalendarViewModels})})};n.update=function(n){i.employeeUpdate(n)};n.showCreate=function(){$(".createContainer").toggleClass("hidden")};n.userSetRole=function(t,r){i.userSetRole(t,r).then(function(){i.userGet().then(function(t){n.data=t.data.ListOfCalendarViewModels})})};n.init()};ManagementController.$inject=["$scope","$http","dataService"];