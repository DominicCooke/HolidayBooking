CalendarController=function(n,t,i){"use strict";function r(n){for(var t=[],i=!0,r=null;n.length!=1;)n[0].StartDate.day()+1==n[1].StartDate.day()&&i==!0&&n[0].BookingStatus==n[1].BookingStatus?(n[0].EndDate=n[1].StartDate,n[0].AllowanceDays++,n.length==2&&t.push(n[0]),n.splice(1,1),i=!1):n[0].EndDate.day()+1==n[1].StartDate.day()&&i==!1&&n[0].BookingStatus==n[1].BookingStatus?(n[0].EndDate=n[1].StartDate,n[0].AllowanceDays++,n.length==2&&t.push(n[0]),n.splice(1,1)):n[0].EndDate.day()+1==n[1].StartDate.day()&&n[0].BookingStatus!=n[1].BookingStatus?(n[1].HolidayId=0,t.push(n[0]),n.length==2&&t.push(n[1]),n.splice(0,1),i=!0):(r==n[0].HolidayId?n[0].HolidayId=0:r=n[0].HolidayId,t.push(n[0]),n.length==2&&t.push(n[1]),n.splice(0,1),i=!0);return t}n.init=function(r){n.mode=r;n.editMode=!1;t.publicHolidaysGet().then(function(u){u.data.forEach(function(n){n.Date=moment(n.Date,"YYYY-MM-DD-Z")});n.publicHolidays=u.data;n.selected=moment();r=="manager"?t.employeesGet().then(function(t){n.teamUserHolidayBookings=t.data;n.initData(n.teamUserHolidayBookings);n.getListOfTeamMembers(n.teamUserHolidayBookings);i.calendarGoToView(n,views.CalendarModeManager);n.tabPendingHolidays=[]}):t.employeesGet().then(function(t){n.teamUserHolidayBookings=t.data;n.initData(n.teamUserHolidayBookings);n.getListOfTeamMembers(n.teamUserHolidayBookings);i.calendarGoToView(n,views.CalendarModeEmployee)})})};n.initData=function(t){for(var i=0;i<t.length;i++)n.parseDateTimeToMoment(t[i].HolidayBookings);for(n.unmergeHolidayBookings(t),i=0;i<t.length;i++)t[i].HolidayBookings=_.sortBy(t[i].HolidayBookings,function(n){return n.StartDate})};n.unmergeHolidayBookings=function(n){for(var u,i,r,t=0;t<n.length;t++){for(u=n[t].HolidayBookings.length,i=0;i<u;i++)while(n[t].HolidayBookings[i].StartDate.day()!=n[t].HolidayBookings[i].EndDate.day())r=_.cloneDeep(n[t].HolidayBookings[i]),r.EndDate=moment(r.EndDate),r.StartDate=r.EndDate,n[t].HolidayBookings.push(r),n[t].HolidayBookings[i].EndDate=n[t].HolidayBookings[i].EndDate.subtract(1,"days");n[t].RemainingAllowance=n[t].HolidayAllowance-n[t].HolidayBookings.length}};n.setAllowanceDaysOfUnmergedHolidays=function(n){for(var t=0;t<n.HolidayBookings.length;t++)n.HolidayBookings[t].AllowanceDays=1};n.parseDateTimeToMoment=function(n){for(var t,i=0;i<n.length;i++)t=n[i],typeof t.StartDate=="object"?(t.StartDate=moment(t.StartDate,"YYYY-MM-DD-Z"),t.EndDate=moment(t.EndDate,"YYYY-MM-DD Z")):(t.StartDate=moment(t.StartDate+"-+0000","YYYY-MM-DD-Z"),t.EndDate=moment(t.EndDate+"-+0000","YYYY-MM-DD Z"))};n.getListOfTeamMembers=function(t){for(var r=[],i=0;i<t.length;i++)r.push({Name:t[i].FirstName+" "+t[i].LastName,StaffId:t[i].StaffId});n.listOfTeamMembers=r};n.toggleEditMode=function(){n.editMode=!n.editMode};n.submitHolidaySingleEmployee=function(){var i,u,f;n.userHolidayBookings.HolidayBookings=_.sortBy(n.userHolidayBookings.HolidayBookings,function(n){return n.StartDate});n.setAllowanceDaysOfUnmergedHolidays(n.userHolidayBookings);i=_.cloneDeep(n.userHolidayBookings);u=i.HolidayBookings;n.parseDateTimeToMoment(u);u.length>0&&(f=r(u),f.length>0&&(i.HolidayBookings=f));i.isVisible=!1;t.employeeUpdateHoliday(i)};n.submitTeamUsersData=function(){for(var f,e,o,s=[],u=n.teamUserHolidayBookings,i=0;i<u.length;i++)u[i].HolidayBookings=_.sortBy(u[i].HolidayBookings,function(n){return n.StartDate}),n.setAllowanceDaysOfUnmergedHolidays(u[i]),f=_.cloneDeep(u[i]),e=f.HolidayBookings,n.parseDateTimeToMoment(e),e.length>0&&(o=r(e),o.length>0&&(f.HolidayBookings=o)),s.push(f);t.employeesUpdateHolidays(s).then(function(){alert("woo")})}};CalendarController.$inject=["$scope","dataService","viewService"];LoginController=function(n,t,i){"use strict";var r=this;n.login=function(){t.getLoginAuthToken(n.username,n.password).then(function(){i.setUser()},function(){$(".alert").show();$("#password").val("")})}};LoginController.$inject=["$scope","dataService","userService"];MenuController=function(n,t,i,r){"use strict";function e(){f();n.$on("loggedIn",function(){n.loginStatus=i.getLoginStatus();var t=r.employeeGetById();n.role=t.RoleName.toLowerCase();n.loggedInUsername=t.FirstName+" "+t.LastName;n.navigate("EmployeeCalendar")})}function f(){t.menuGotoView(n,views.Menu,".side-bar-menu");t.gotoView(n,views.Login);n.loginStatus=i.getLoginStatus()}var u;n.logOut=function(){i.setToken("",!1);f()};n.navigate=function(i){var r,f;typeof n.state=="undefined"&&(n.state="New");n.state=="New"?(n.state="Old",u=n.$new(),t.gotoView(u,views[i])):(u.$destroy(),$(".bodyContainer").empty(),n.state="New",n.navigate(i));r=angular.element(document.getElementsByClassName("active"));r.removeClass();f=angular.element(document.getElementById(i));f.addClass("active")};e()};MenuController.$inject=["$scope","viewService","tokenService","userService"];UserTableController=function(n,t,i){"use strict";n.init=function(){i.userGet().then(function(t){n.data=t.data.ListOfCalendarViewModels;n.roles=t.data.ListOfIdentityRoles})};n.delete=function(t){i.userDelete(t).then(function(){i.userGet().then(function(t){n.data=t.data.ListOfCalendarViewModels})})};n.register=function(t){i.userRegister(t).then(function(){$(".createContainer").toggleClass("hidden");$(".createUserForm").trigger("reset");i.userGet().then(function(t){n.data=t.data.ListOfCalendarViewModels})})};n.update=function(n){i.employeeUpdate(n)};n.showCreate=function(){$(".createContainer").toggleClass("hidden")};n.userSetRole=function(t,r){i.userSetRole(t,r).then(function(){i.userGet().then(function(t){n.data=t.data.ListOfCalendarViewModels})})};n.init()};UserTableController.$inject=["$scope","$http","dataService"];
//# sourceMappingURL=controllers.min.js.map
