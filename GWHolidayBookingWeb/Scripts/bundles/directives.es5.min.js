"use strict";infoBoxDirective=function(){return{restrict:"E",templateUrl:"/Scripts/app/calendar/employee/infoBox.html",controller:"CalendarController",scope:!0,link:function(n){n.$watch("userHolidayBookings",function(){var r=0,u=0,f=0,i,t;if(typeof n.userHolidayBookings!="undefined"){for(i=n.userHolidayBookings.HolidayBookings,t=0;t<i.length;t++)i[t].BookingStatus===0?r++:i[t].BookingStatus===1?u++:f++;n.infoBoxDays={Pending:r,Confirmed:u,Cancelled:f,Remaining:n.userHolidayBookings.RemainingAllowance,Name:n.userHolidayBookings.FirstName+" "+n.userHolidayBookings.LastName}}},!0)}}};calendarDirective=function(n,t,i){return{restrict:"E",templateUrl:function(t,i){return n[i.mode]},controller:"CalendarController",scope:!1,link:function(n){function u(i,r){var u=!0;n.changes.forEach(function(t){var r=n.changes.indexOf(t);t.dateChange.isSame(i,"day")&&(u=!1,n.changes.splice(r,1))});u&&(n.changes.push({dateChange:i,stateChange:r}),t(function(){n.slideDownChangesContainerTableRow()}))}function o(n){var t=n.day();return t===6||t===0?!0:!1}function s(t){for(var u,e,f=0,r=n.teamUserHolidayBookings,i=0;i<r.length;i++)if(r[i].isVisible===!0)for(u=0;u<r[i].HolidayBookings.length;u++)if(e=r[i].HolidayBookings[u],e.StartDate.isSame(t,"day")&&e.BookingStatus===1){f++;break}if(f>0)return f}function r(t,i){var f=!1,u,r;if(n.userHolidayBookings.isVisible===!0)for(u=n.userHolidayBookings.HolidayBookings,r=0;r<u.length;r++)if(u[r].StartDate.isSame(t,"day")&&u[r].BookingStatus===i){f=!0;break}return f}function h(t){for(var i,r=0;r<n.publicHolidays.length;r++)if(n.publicHolidays[r].Date.isSame(t,"day")){i=!0;break}else i=!1;return i}function c(t,i){for(var f,e,u=n.teamUserHolidayBookings,r=0;r<u.length;r++)if(u[r].isVisible===!0)for(f=0;f<u[r].HolidayBookings.length;f++)if(e=u[r].HolidayBookings[f],e.StartDate.isSame(t,"day")&&e.BookingStatus===i)return!0;return!1}function f(n){return n.day(1).hour(0).minute(0).second(0).millisecond(0)}function e(n,t,i){n.weeks=[];for(var u=!1,r=t.clone(),f=r.month(),e=0;!u;)n.weeks.push({days:l(n,r.clone(),i)}),r.add(1,"w"),u=e++>2&&f!==r.month(),f=r.month()}function l(n,t,i){for(var u=[],f=0;f<7;f++)n.mode==="manager"?u.push({name:t.format("dd").substring(0,1),number:t.date(),isCurrentMonth:t.month()===i.month(),isToday:t.isSame(new Date,"day"),isPublicHoliday:h(t),isWeekend:o(t),date:t,isPendingHoliday:c(t,0),isCancelledHoliday:c(t,2),holidayCount:s(t)}):u.push({name:t.format("dd").substring(0,1),number:t.date(),isCurrentMonth:t.month()===i.month(),isToday:t.isSame(new Date,"day"),isPublicHoliday:h(t),isWeekend:o(t),date:t,isConfirmedHoliday:r(t,1),isCancelledHoliday:r(t,2),isPendingHoliday:r(t,0),holidayCount:s(t)}),t=t.clone(),t.add(1,"d");return u}function a(){n.mode==="employee"&&(n.userHolidayBookings=i.employeeGetById(),n.initData([n.userHolidayBookings]),n.userHolidayBookings.isVisible=!0);n.reloadCalendar()}n.select=function(t){var h,i,f,c,l;n.selected=t;var e=0,o=1,s=2;if(n.editMode===!0){if((r(t,e)===!0||r(t,o)===!0||r(t,s)===!0)&&(h=!0),i=n.userHolidayBookings.HolidayBookings,h===!0)for(f=0;f<i.length;f++)i[f].StartDate.isSame(t,"day")&&(i[f].BookingStatus===e?(i.splice(f,1),n.userHolidayBookings.RemainingAllowance++,u(t,"Unbook Holiday")):i[f].BookingStatus===o?(i[f].BookingStatus=s,u(t,"Cancel Holiday")):i[f].BookingStatus===s&&(i[f].BookingStatus=o,u(t,"Uncancel Holiday")));else n.userHolidayBookings.RemainingAllowance--,c=t.clone().add(1,"h"),l=t.clone().add(1,"h"),i.push({StartDate:c,EndDate:l,AllowanceDays:1,BookingStatus:e,HolidayId:0}),u(t,"Book Holiday");n.reloadCalendar(!0);n.teamHolidayCount()}};n.next=function(){var t=n.month.clone();f(t.month(t.month()+1).date(0));n.month.month(n.month.month()+1);e(n,t,n.month);n.selected=n.month.clone();n.teamHolidayCount()};n.previous=function(){var t=n.month.clone();f(t.month(t.month()-1).date(0));n.month.month(n.month.month()-1);e(n,t,n.month);n.selected=n.month.clone();n.teamHolidayCount()};n.teamHolidayCount=function(){t(function(){$(".day").each(function(){for(var i,t=$(this)[0].getAttribute("amountofholiday"),n=0;n<=t;n++)if(i=$(this).hasClass("employeeCalendar")?"teamHolidayEmployee"+n:"teamHoliday"+n,$(this).hasClass(i)){$(this).children(".confirmedHolidayCount").text(t);$(this).children(".confirmedHolidayCount").css("display")==="none"&&$(this).children(".confirmedHolidayCount").fadeIn("fast");break}})})};n.reloadCalendar=function(t){var i;t===!0?i=n.month.clone():(n.month=n.selected.clone(),i=n.selected.clone());i.date(-3);f(i.day(0));e(n,f(i.endOf("month")),n.month)};a()}}};calendarControlsDirective=function(n,t,i){return{restrict:"E",templateUrl:function(n,i){return t[i.mode]},controller:"CalendarController",scope:!1,link:function(n){function t(t,i){var f=!1,e=$(".teamMember"),u=n.teamUserHolidayBookings,r;if(t==="all")for(i.target.classList.contains("active")&&(f=!0),e.toggleClass("dead"),e.removeClass("active"),r=0;r<u.length;r++)u[r].isVisible=f;else for(r=0;r<u.length;r++)u[r].StaffId===t&&(u[r].isVisible=!u[r].isVisible)}n.$watch("holidayRequests",function(){if(n.mode==="manager"&&typeof n.holidayRequests!="undefined"){var t=$(".actionsContainer");n.holidayRequests.HolidayRequests.length===0}},!0);n.$watch("changes",function(){if(n.mode==="employee"&&typeof n.changes!="undefined"){var t=$(".changesContainer");n.changes.length===0?n.hideChanges(t):(t.is(":hidden")||t.hasClass("hiding"))&&t.clearQueue().stop().animate({height:"show"},600)}},!0);n.hideChanges=function(n,t){n.addClass("hiding").clearQueue().animate({height:"hide"},600,function(){$(this).hide();$(this).removeClass("hiding");typeof t=="function"&&t()})};n.$watch("teamUserHolidayBookings",function(){var t;if(n.mode==="manager"&&typeof n.teamUserHolidayBookings!="undefined"){var u=n.teamUserHolidayBookings,i=0,r=0;for(t=0;t<u.length;t++)i=i+u[t].PendingHolidays,r=r+u[t].CancelledHolidays;n.pendingNotificationCount=i;n.cancelledNotificationCount=r;i===0?$(".notification-counter-pending").hide():$(".notification-counter-pending").show();r===0?$(".notification-counter-cancelled").hide():$(".notification-counter-cancelled").show()}},!0);n.slideDownChangesContainerTableRow=function(){var n=$(".tableBody.changes").children("tbody").children("tr:last");n.children(".tableCellAction").wrapInner('<div class="td-slider fa fa-times" style="display:none;"/>');n.removeClass("hidden").children(".tableCell.default").wrapInner('<div class="td-slider" style="display:none;"/>');n.children("td").children(".td-slider").clearQueue().stop().animate({height:"show",padding:"3px"},700)};n.slideUpChangesContainerTableRow=function(t,i){var r=$(t.target).parent("td").parent("tr");$(r).children("td").children(".td-slider").clearQueue().stop().animate({height:"hide",padding:"0"},700,function(){var t=this.parentNode.cellIndex;t==0&&n.select(i)})};n.acceptChanges=function(){n.mode==="employee"?n.submitHolidaySingleEmployee():n.submitTeamUsersData();n.toggleSubmitStatus()};n.toggleSubmitStatus=function(){var i=$(".acceptSlider"),n=$(".acceptText"),r=$(".declineSlider"),t=$(".declineText"),u=$(".submitText");i.toggleClass("active");r.toggleClass("active");u.toggleClass("active");n.clearQueue().stop();t.clearQueue().stop();n.fadeToggle(800);t.fadeToggle(800)};n.teamMemberSelected=function(i){var r=i.target.getAttribute("value");$(i.target).toggleClass("active");t(r,i);n.reloadCalendar(!0);n.teamHolidayCount()};n.populateTableCounts=function(n){for(var r=0,u=0,f=0,i=n.HolidayBookings,t=0;t<i.length;t++)i[t].BookingStatus===0?r++:i[t].BookingStatus===1?u++:f++;n.PendingHolidays=r;n.ConfirmedHolidays=u;n.CancelledHolidays=f};n.addScrollBar=function(){jQuery(".scrollBar").scrollbar()};n.formatDate=function(n,t){if(typeof n!="undefined"){var r=n.toObject(),i=moment(r);return t===1?i.format("dddd, MMM Do YYYY"):t===2?i.format("ddd MMM Do YYYY"):i.format("DMYYYY")}};n.holidayRequestAction=function(t,i,r,u){for(var o,h,s,e=n.teamUserHolidayBookings,f=0;f<e.length;f++)if(e[f].StaffId===i)for(o=0;o<e[f].HolidayBookings.length;o++)if(e[f].HolidayBookings[o].StartDate.isSame(t,"day")&&e[f].StaffId===i){for(h=n.holidayRequests,s=0;s<h.HolidayRequests.length;s++)h.HolidayRequests[s].StaffId===e[f].StaffId&&h.HolidayRequests[s].HolidayDate===e[f].HolidayBookings[o]&&h.HolidayRequests.splice(s,1);u==="accept"?e[f].HolidayBookings[o].BookingStatus===0?e[f].HolidayBookings[o].BookingStatus=1:(e[f].HolidayBookings.splice(o,1),e[f].RemainingAllowance++):e[f].HolidayBookings[o].BookingStatus===0?(e[f].HolidayBookings.splice(o,1),e[f].RemainingAllowance++):e[f].HolidayBookings[o].BookingStatus=1}n.reloadCalendar();n.teamHolidayCount()};n.holidayRequestSelect=function(t,r,u){var h=u.target.parentElement.firstElementChild,e,c,f,o,s;if(u.target.innerText>0){for($(".tableCell").removeClass("clicked"),$(u.target).addClass("clicked"),$(u.target).hasClass("isCancelledHoliday")?$(u.target).effect("highlight",{color:"rgb(155, 89, 182);"},400):$(u.target).effect("highlight",{color:"rgb(52, 152, 219);"},400),i(function(){$(h).hasClass("active")||$(h).hasClass("dead")||$(h).trigger("click")}),e=n.teamUserHolidayBookings,c=[],f=0;f<e.length;f++)if(e[f].HolidayBookings=_.sortBy(e[f].HolidayBookings,function(n){return n.StartDate}),e[f].StaffId===t)for(o=0;o<e[f].HolidayBookings.length;o++)e[f].HolidayBookings[o].BookingStatus===r&&c.push({StaffId:t,HolidayDate:e[f].HolidayBookings[o],TypeOfHoliday:r});n.holidayRequests={HolidayRequests:c,TypeOfHoliday:r};s=$(".actionsContainer");(s.is(":hidden")||s.hasClass("hiding"))&&s.clearQueue().stop().animate({height:"show"},600)}}}}};tooltipDirective=function(n){return{restrict:"E",templateUrl:function(t,i){return n[i.mode]},controller:"CalendarController",scope:!1,link:function(n){function t(t){for(var h,r,i,u,f=[],o=0,s=0,e=0;e<n.listOfTeamMembers.length;e++)h={name:n.listOfTeamMembers[e],isFoundState:"crossed"},f.push(h);for(r=n.teamUserHolidayBookings,i=0;i<r.length;i++)for(u=0;u<r[i].HolidayBookings.length;u++)r[i].HolidayBookings[u].StartDate.isSame(t,"day")&&(o++,r[i].HolidayBookings[u].BookingStatus===0?f[i].isFoundState="pending":r[i].HolidayBookings[u].BookingStatus===1?(f[i].isFoundState="checked",s++):f[i].isFoundState="cancelled");return{allCount:o,names:f,confirmedCount:s}}n.checkIsFound=function(t){n.isFoundValue=null;t==="checked"?n.isFoundValue="checked":t==="pending"?n.isFoundValue="pending":t==="cancelled"&&(n.isFoundValue="cancelled")};n.getHolidayAmount=function(t){n.HolidayAmount=t};n.showTooltip=function(i,r){var u=t(r.date);if(r.isTeamHoliday===!1||u.allCount===0){n.tooltipIsVisible=!1;return}n.tooltipIsVisible=!0;var e=i.clientX+40+"px",o=i.clientY+"px",f=$(".hoverTooltip")[0];f.style.left=e;f.style.top=o;n.holidayConfirmCountTooltip=u.confirmedCount;n.holidayCountTooltip=u.allCount;n.holidayEmployeeNamesTooltip=u.names};n.moveTooltip=function(n){var i=n.clientX+40+"px",r=n.clientY+"px",t=$(".hoverTooltip")[0];t.style.left=i;t.style.top=r};n.hideTooltip=function(){n.tooltipIsVisible=!1}}}};